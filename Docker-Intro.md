## Table of Contents

* [Docker](#docker)
* [Orchestration](#orchestration)
* [Images](#images)
* [Containers](#containers)
* [Volumes](#volumes)
* [Dockerfile](#dockerfile)
* [Docker-Compose](#docker-compose)
* [Docker CLI](#docker-cli)
* [Sample Project](#sample-project)

Docker(docker) written in **GO** language : Docker compose(docker compose) written in **PYTHON**

## Docker
Docker is an open source platform that enables developers to build, deploy, run, update and manage containers—standardized, executable components that combine application source code with the operating system (OS) libraries and dependencies required to run that code in any environment. For more details
[visit here](https://docs.docker.com/get-started/overview/).

### Docker technology ### 
Docker technology consists of the runtime, engine and orchestrator

* **Runtime:** Responsible for starting and stopping containers.

* **Daemon/Engine:** Expose the Docker remote API, manage images, volumes, networks etc.

* **Orchestrator:** Manging clusters (Swarns) of nodes running docker.

![Docker technology](/images/docker-technology.png)

## Orchestration

Container orchestration is the automation of much of the operational effort required to run containerized workloads and services. This includes a wide range of things software teams need to manage a container’s lifecycle, including provisioning, deployment, scaling (up and down), networking, load balancing and more.

**References**

* [Official docker orchestration](https://docs.docker.com/get-started/orchestration/)

* [Other reference](https://avinetworks.com/glossary/container-orchestration/)

* [Quick reference](https://www.redhat.com/en/topics/containers/what-is-container-orchestration)

* [Why do we need container orchestration?](https://www.vmware.com/topics/glossary/content/container-orchestration.html)

## Images

An image is a read-only template with instructions for creating a Docker container.

## Containers
Containers are executable units of software in which application code is packaged, along with its libraries and dependencies, in common ways so that it can be run anywhere, whether it be on desktop, traditional IT, or the cloud.

[Your basic isolated Docker process](http://etherealmind.com/basics-docker-containers-hypervisors-coreos/). Containers are to Virtual Machines as threads are to processes.

A container is a runable instance of an image. Can create, start, stop, move or delete a container using the Docker API or CLI.

![Container](/images/container.png)

## Volumes
Two main categories of data: Persistent and non-persistent

* **Non-persistent:** Data gets written to the top layer and gets deleted with the container.

* **Persistent:** Need to keep even after container deletion.

Volumes are used to persist data

Docker volumes are a widely used and useful tool for ensuring data persistence while working in containers. Docker volumes are file systems mounted on Docker containers to preserve data generated by the running container.

**References**

* [Official docker volumes](https://docs.docker.com/storage/volumes/)

* [Other reference](https://earthly.dev/blog/docker-volumes/)

* [Quick reference](https://phoenixnap.com/kb/what-is-docker)

## Dockerfile

A Dockerfile is the starting point for creating a container image. It describes an application and tells Docker how to build it into an image. For more details [visit here](https://docs.docker.com/engine/reference/builder/)

**WHY:** To customize our container

**Dockerfile** ==> *docker build* ==> **Docker image** ==> *docker run* ==> **Docker Container**

### Instructions / Commands

* [.dockerignore](https://docs.docker.com/engine/reference/builder/#dockerignore-file)
* [FROM](https://docs.docker.com/engine/reference/builder/#from) Sets the Base Image for subsequent instructions.
* [MAINTAINER (deprecated - use LABEL instead)](https://docs.docker.com/engine/reference/builder/#maintainer-deprecated) Set the Author field of the generated images.
* [RUN](https://docs.docker.com/engine/reference/builder/#run) execute any commands in a new layer on top of the current image and commit the results.
* [CMD](https://docs.docker.com/engine/reference/builder/#cmd) provide defaults for an executing container.
* [EXPOSE](https://docs.docker.com/engine/reference/builder/#expose) informs Docker that the container listens on the specified network ports at runtime.  NOTE: does not actually make ports accessible.
* [ENV](https://docs.docker.com/engine/reference/builder/#env) sets environment variable.
* [ADD](https://docs.docker.com/engine/reference/builder/#add) copies new files, directories or remote file to container.  Invalidates caches. Avoid `ADD` and use `COPY` instead.
* [COPY](https://docs.docker.com/engine/reference/builder/#copy) copies new files or directories to container.  By default this copies as root regardless of the USER/WORKDIR settings.  Use `--chown=<user>:<group>` to give ownership to another user/group.  (Same for `ADD`.)
* [ENTRYPOINT](https://docs.docker.com/engine/reference/builder/#entrypoint) configures a container that will run as an executable.
* [VOLUME](https://docs.docker.com/engine/reference/builder/#volume) creates a mount point for externally mounted volumes or other containers.
* [USER](https://docs.docker.com/engine/reference/builder/#user) sets the user name for following RUN / CMD / ENTRYPOINT commands.
* [WORKDIR](https://docs.docker.com/engine/reference/builder/#workdir) sets the working directory.
* [ARG](https://docs.docker.com/engine/reference/builder/#arg) defines a build-time variable.
* [ONBUILD](https://docs.docker.com/engine/reference/builder/#onbuild) adds a trigger instruction when the image is used as the base for another build.
* [STOPSIGNAL](https://docs.docker.com/engine/reference/builder/#stopsignal) sets the system call signal that will be sent to the container to exit.
* [LABEL](https://docs.docker.com/config/labels-custom-metadata/) apply key/value metadata to your images, containers, or daemons.
* [SHELL](https://docs.docker.com/engine/reference/builder/#shell) override default shell is used by docker to run commands.
* [HEALTHCHECK](https://docs.docker.com/engine/reference/builder/#healthcheck) tells docker how to test a container to check that it is still working.

**Example**
```
# Base image
FROM ubuntu:22.04
RUN echo "It is working fine!!"

ENV TZ=Asia/Kolkata DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install tzdata

# Work directory
WORKDIR /var/www/html

# Install Apache
RUN apt-get -y install apache2 
RUN apt-get -y install apache2-utils 
RUN apt-get clean 
EXPOSE 80

# Enable rewrite module
RUN a2enmod rewrite

# Install PHP
RUN apt-get -y install --no-install-recommends php8.1
RUN apt-get -y install php8.1-common php8.1-mysql php8.1-zip php8.1-gd php8.1-mbstring php8.1-curl

# Install composer
RUN php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');" && \
	php composer-setup.php && \
	mv composer.phar /usr/local/bin/composer && \
	php -r "unlink('composer-setup.php');"
ENV PATH="~/.composer/vendor/bin:${PATH}"

# Remove apache default index html file
RUN rm -rf index.html

# Define path variable
ARG SITE_PATH=/var/www/html
ENV PATH=$SITE_PATH

# This is resolve 404 isseue
RUN echo "\n<Directory /var/www/>" >> /etc/apache2/apache2.conf
RUN echo "\t Options Indexes FollowSymLinks" >> /etc/apache2/apache2.conf
RUN echo "\t AllowOverride All" >> /etc/apache2/apache2.conf
RUN echo "\t Require all granted" >> /etc/apache2/apache2.conf
RUN echo "</Directory>" >> /etc/apache2/apache2.conf

RUN echo "Done, please browse to http://127.0.0.1:8000/web to check!"
RUN service apache2 restart


#Install drush
RUN composer global require drush/drush

CMD ["/usr/sbin/apachectl", "-D", "FOREGROUND"]
```

## Docker Compose

Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application’s services. Then, with a single command, you create and start all the services from your configuration. To learn more about all the features of Compose [visit here](https://docs.docker.com/compose/compose-file/).

**Example**
```
version: '3.1'

services:

# Pull image of mariadb
  drupal10_db: # this is host of database
    image: mariadb:10.5.9
    container_name: mariadb
    ports:
      - 3308:3307
    restart: always
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_DATABASE=drupal10
      - MYSQL_USER=drupal10
      - MYSQL_PASSWORD=drupal10

# Pull image of drupal from dockerfile
  drupal:
    container_name: "${COMPOSE_PROJECT_NAME}"
    depends_on:
      - drupal10_db
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8000:80"
    volumes:
      - d_modules:/var/www/html/web/modules
      - d_themes:/var/www/html/web/themes
      - d_profiles:/var/www/html/web/profiles
      - d_sites:/var/www/html/web/sites
    links:
      - drupal10_db:mariadb
    restart: always

# Pull image of phpmyadmin
  phpmyadmin:
    image: phpmyadmin:5.2.0
    container_name: phpmyadmin
    ports:
      - 9000:80
    environment:
      - PMA_ARBITRARY=1
    restart: always

volumes:
  d_modules:
  d_themes:
  d_profiles:
  d_sites:
```

## Docker CLI ##

**Docker run**

**Syntax:** *docker run -d --name container_name -e image_params image_name*

Example
```
docker run -d --name mysqldb -e MYSQL_ROOT_PASSWORD=password mysql

docker run -d --name drupal --link mysqldb -p 8080:80 -e MYSQL_USER:root -e MYSQL_PASSWORD:password drupal

docker run -d --name phpmyadmin --link mysqldb:db -p 9090:80 phpmyadmin
```
[Official reference](https://docs.docker.com/engine/reference/commandline/run/)

**Docker images**
 - Get all images
   ```
   docker images
   ```
- Remove docker images
  ```
  docker rmi image-name/image-id
  docker rmi -f image-name/image-id (forecfully)
  ```


**Docker process status**

- Get list of containers
```
docker ps
  OR
docker container ls
```
- Get list of running as well as stopped container
```
docker ps -a
  OR
docker container ls -a
```

**Clear docker cache**
```
docker rmi $(docker images -a -q)
docker system prune -a
```

**Docker permission denied error (ubuntu)**
```
sudo chmod 666 /var/run/docker.sock
sudo usermod -aG docker $USER
```

The -it flags will connect the current terminal window to the container's shell

[Official reference](https://docs.docker.com/engine/reference/commandline/docker/)

## Sample Project ##

### Lifecycle

* [`docker create`](https://docs.docker.com/engine/reference/commandline/create) creates a container but does not start it.
* [`docker rename`](https://docs.docker.com/engine/reference/commandline/rename/) allows the container to be renamed.
* [`docker run`](https://docs.docker.com/engine/reference/commandline/run) creates and starts a container in one operation.
* [`docker rm`](https://docs.docker.com/engine/reference/commandline/rm) deletes a container.
* [`docker update`](https://docs.docker.com/engine/reference/commandline/update/) updates a container's resource limits.

### Play with Docker

Play with Docker (PWD) provides a free-to-use fully functional Docker playground that lasts for 4 hours. For playing with docker [click here](https://labs.play-with-docker.com/)

## Miscellaneous

### What is the difference between Docker and Docker Compose? ###

**Docker**

Docker is a tool which is used by developer and operation teams to create and automate the deployment of applications in lightweight containers so that applications can work efficiently in different environments.

![This is an image](/images/docker.png)

**Docker compose**

1. Docker Compose is used for running multiple containers as a single service
2. Here, containers run in isolation but can interact with each other
3. All Docker Compose files are YAML files
4. In Docker Compose, a user can start all the services (containers) using a single command

![This is an image](/images/docker-compose.png)

**Example**

![This is an image](/images/docker-compose-example.png)

### What is different between Docker and Docker-Swarm? ###

You really can’t compare Docker with Docker swarm. Docker is a tool that enables you to use containers, where you could deploy applications into. You could think of it as a very lightweight virtual machine. Docker swarm on the other hand is an orchestration and clustering tool for Docker containers, it uses docker internally. Docker swarm comes in handy if you have dozens to thousands of containers. It manages and schedules these containers. It decides to which container it should route the current request to through load balancing and service discovery.

The correct comparison would be comparing Docker Swarm and Kubernetes, but that’s for another question.

### What is the difference between Docker Compose and Docker Run? ###

Docker Compose is used to run multiple containers as a single service. For example, suppose you had an application that required NGNIX and MySQL, you could create one file which would start both the containers as a service without the need to start each one separately.

Docker runs processes in isolated containers. A container is a process that runs on a host. The host may be local or remote. When an operator executes docker run, the container process that runs is isolated in that it has its own file system, its own networking, and its own isolated process tree separate from the host.

### Microservices ##

Microservices - also known as the microservice architecture - is an architectural style that structures an application as a collection of services that are

* Highly maintainable and testable
* Loosely coupled
* Independently deployable
* Organized around business capabilities
* Owned by a small team

The microservice architecture enables the rapid, frequent and reliable delivery of large, complex applications. It also enables an organization to evolve its technology stack. For more details [visit here](https://microservices.io/).

**Other reference**

[What are microservices](https://www.redhat.com/en/topics/microservices/what-are-microservices)
